<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Content</title>
    <style>
        /* Ваши стили остаются без изменений */
    </style>
</head>

<body>
    <div id="audioContainer">
        <audio id="audioPlayer" controls>
            <source src="https://github.com/IgorGeraskin22/transribe/raw/gh-pages/1.mp3">
            Ваш браузер не поддерживает аудиоэлемент.
        </audio>
        <button onclick="skip(-10)">⏪ 10s</button>
        <button onclick="skip(-2)">⏪</button>
        <button onclick="skip(2)">⏩</button>
        <button onclick="skip(10)">⏩ 10s</button>
        <input type="number" id="offsetInput" value="0">
        <button onclick="changeSpeed(-0.1)">Уменьшить скорость</button>
        <button onclick="changeSpeed(0.1)">Увеличить скорость</button>
        <span id="speedIndicator">Скорость: 1.0x</span>
        <input type="number" id="offsetInput" value="0">
        <button onclick="updateOffset(1)">Время вперед</button>
        <button onclick="updateOffset(-1)">Время назад</button>
    </div>

    <div id="audioContent">
        <div class="editable" contenteditable="true" id="editableText">
            <br />
            <!-- Ваш текст -->
        </div>
        <button onclick="saveContent()">Сохранить</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const audioPlayer = document.getElementById('audioPlayer');
            const editableText = document.getElementById('editableText');
            const speedIndicator = document.getElementById('speedIndicator');
            const offsetInput = document.getElementById('offsetInput');

            audioPlayer.onerror = function () {
                showError('Произошла ошибка при воспроизведении аудио.');
            };

            function showError(message) {
                const errorContainer = document.createElement('div');
                errorContainer.classList.add('error');
                errorContainer.textContent = message;
                document.body.appendChild(errorContainer);
            }

            function skip(time) {
                audioPlayer.currentTime += time;
            }

            function changeSpeed(amount) {
                audioPlayer.playbackRate += amount;
                speedIndicator.textContent = `Скорость: ${audioPlayer.playbackRate.toFixed(1)}x`;
            }

            function updateOffset(amount) {
                offsetInput.value = parseFloat(offsetInput.value) + amount;
                jumpToTime(audioPlayer.currentTime); // Применяем новое смещение времени сразу
            }

            function jumpToTime(seconds) {
                const offset = parseFloat(offsetInput.value) || 0;
                const startTime = seconds + offset;
                const hours = Math.floor(startTime / 3600);
                const minutes = Math.floor((startTime % 3600) / 60);
                const remainingSeconds = startTime % 60;
                const formattedTime = `${padZero(hours)}:${padZero(minutes)}:${padZero(remainingSeconds)}`;

                audioPlayer.addEventListener('loadedmetadata', function () {
                    audioPlayer.play();
                    console.log(`Jumping to time: ${formattedTime} (with offset: ${offset})`);
                });

                audioPlayer.currentTime = startTime;
            }

            function padZero(num) {
                return num.toString().padStart(2, '0');
            }

            function saveContent() {
                localStorage.setItem('editableContent', editableText.innerHTML);
                alert('Текст сохранен локально!');
            }

            window.onload = function () {
                const storedContent = localStorage.getItem('editableContent');
                if (storedContent) {
                    editableText.innerHTML = storedContent;
                }
            };
        });
    </script>
</body>

</html>
